#include <WiFi.h>

// WiFi credentials
const char* ssid = "YourWiFiName";
const char* password = "YourWiFiPassword";

// Create server on port 8080
WiFiServer server(8080);

void setup() {
  Serial.begin(9600);  // Debug
  Serial2.begin(9600, SERIAL_8N1, 16, 17); // RX=16, TX=17 â†’ Arduino

  Serial.println("Connecting to WiFi...");
  WiFi.begin(ssid, password);

  int retry = 0;
  while (WiFi.status() != WL_CONNECTED && retry < 30) {
    delay(500);
    Serial.print(".");
    retry++;
  }

  if (WiFi.status() != WL_CONNECTED) {
    Serial.println("\nâŒ WiFi connection failed!");
    return;
  }

  Serial.println("\nâœ… WiFi connected!");
  Serial.print("ðŸ“¡ ESP32 IP: ");
  Serial.println(WiFi.localIP());

  server.begin();
  Serial.println("ðŸŒ Server started on port 8080!");
}

void loop() {
  WiFiClient client = server.available();
  if (!client) {
    delay(10);
    return;
  }

  Serial.println("ðŸ’» Client connected");

  while (client.connected()) {
    if (client.available()) {
      String cmd = client.readStringUntil('\n');
      cmd.trim();

      if (cmd.length()) {
        Serial.println("ðŸ“© Received: " + cmd);
        Serial2.println(cmd);      // Send command to Arduino
        client.println("OK");      // Send confirmation to PC
      }
    }
  }

  client.stop();
  Serial.println("ðŸ”Œ Client disconnected");
}
